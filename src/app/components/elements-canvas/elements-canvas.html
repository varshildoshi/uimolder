<section
  class="flex-1 bg-[radial-gradient(#ffffff05_1px,transparent_1px)] bg-size[30px_30px] flex flex-col overflow-hidden h-[calc(100vh-150px)] overflow-y-auto">

  <div class="flex-1 p-8 flex flex-col gap-8 scroll-container">

    <!-- Canvas Controls -->
    <div class="max-w-6xl mx-auto w-full flex items-center justify-between shrink-0">
      <!-- View Toggle (Left) -->
      <div class="flex items-center gap-1 bg-white/[0.05] p-1 rounded-xl border border-white/10 backdrop-blur-md">
        <button (click)="setViewMode('editor')" [class.bg-brand-gold]="viewMode() === 'editor'"
          [class.text-black]="viewMode() === 'editor'"
          class="px-4 py-1.5 rounded-lg text-[12px] font-medium transition-all flex items-center gap-2 tracking-widest">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-geometry text-[16px]">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M7 21l4 -12m2 0l1.48 4.439m.949 2.847l1.571 4.714" />
            <path d="M10 7a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
            <path d="M4 12c1.526 2.955 4.588 5 8 5c3.41 0 6.473 -2.048 8 -5" />
            <path d="M12 5v-2" />
          </svg>
          EDITOR
        </button>
        <button (click)="setViewMode('preview')" [class.bg-brand-gold]="viewMode() === 'preview'"
          [class.text-black]="viewMode() === 'preview'"
          class="px-4 py-1.5 rounded-lg text-[12px] font-medium transition-all flex items-center gap-2 tracking-widest">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="icon icon-tabler icons-tabler-outline icon-tabler-eye text-[16px]">
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
            <path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
          </svg>
          PREVIEW
        </button>
      </div>

      <!-- Add Row Button (Right, Only in Editor) -->
      @if (viewMode() === 'editor') {
      <button (click)="elementService.addRow()"
        class="flex items-center gap-2 btn-primary px-4 py-2 font-semibold text-xs uppercase tracking-tight transition-all shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-plus text-sm">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <path d="M12 5l0 14" />
          <path d="M5 12l14 0" />
        </svg>
        Add Row
      </button>
      }
    </div>

    @if (viewMode() === 'editor') {
    <app-element-editor />
    } @else {
    <app-element-preview />
    }

    <!-- Unified Rows Container -->
    <!-- <div class="max-w-5xl mx-auto w-full transition-all duration-500 pb-20" [ngClass]="{
        'flex flex-col gap-12': viewMode() === 'editor',
        'bg-white/[0.02] border border-white/5 shadow-2xl rounded-[32px] p-10 flex flex-col gap-6': viewMode() === 'preview'
      }">

      @if (viewMode() === 'preview') {
      <h2
        class="text-[15px] tracking-[0.3em] mb-4 text-brand-gold border-b border-brand-gold/10 pb-2 animate-in fade-in duration-300">
        Molding Result</h2>
      }

      @for (row of formRows(); track row.id) {
      <div class="relative group/row w-full">
        <div [id]="row.id" cdkDropList [cdkDropListData]="row.fields" [cdkDropListConnectedTo]="rowIds()"
          [cdkDropListDisabled]="viewMode() === 'preview'" [cdkDropListOrientation]="'horizontal'"
          (cdkDropListDropped)="onDrop($event, row.id)" class="min-h-[100px] transition-all relative flex flex-wrap"
          [ngClass]="{
              'border-2 border-dashed border-slate-800 rounded-3xl p-8 gap-6': viewMode() === 'editor',
              'justify-center': viewMode() === 'editor' && row.fields.length === 0,
              'gap-6': viewMode() === 'preview'
            }">

          @if (viewMode() === 'editor') {
          <div
            class="absolute -top-8 left-2 right-2 flex items-center justify-between mb-2 animate-in fade-in duration-300">
            <div class="flex items-center gap-3">
              <span class="text-[10px] font-mono text-brand-gold/50 uppercase tracking-widest">Row Layout</span>
            </div>
            @if (formRows().length > 1) {
            <button (click)="onRemoveRow(row.id)"
              class="opacity-0 group-hover/row:opacity-100 transition-opacity text-slate-600 hover:text-red-500">
              <mat-icon class="text-sm">delete</mat-icon>
            </button>
            }
          </div>
          }

          @if (row.fields.length === 0 && viewMode() === 'editor') {
          <div
            class="absolute inset-0 flex items-center justify-center text-slate-700 pointer-events-none empty-placeholder">
            <p class="font-mono text-[14px] uppercase tracking-widest transition-all duration-300">Drop elements here
            </p>
          </div>
          }

          @for (item of row.fields; track item.id) {
          <div (click)="viewMode() === 'editor' ? onSelectElement(item.id) : null" cdkDrag
            [cdkDragDisabled]="viewMode() === 'preview'"
            class="rounded-lg relative group/field transition-all flex-1 min-w-[250px]" [ngClass]="{
                  'bg-white/[0.02] border border-white/10 cursor-pointer p-6': viewMode() === 'editor',
                  'ring-2 ring-brand-gold': viewMode() === 'editor' && selectedElementId() === item.id,
                  'bg-transparent border-0 p-2': viewMode() === 'preview'
                }">

            @if (viewMode() === 'editor') {
            <button (click)="onRemoveItem(item.id, $event)"
              class="absolute -top-2 -right-2 w-7 h-7 bg-red-500/10 border border-red-500/20 text-red-500 rounded-full flex items-center justify-center opacity-0 group-hover/field:opacity-100 hover:bg-red-500 hover:text-white transition-all z-10">
              <mat-icon class="text-sm">close</mat-icon>
            </button>

            <div
              class="flex items-center justify-between mb-4 border-b border-white/5 pb-2 animate-in fade-in duration-300">
              <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                  <span class="text-[16px] text-slate-500 font-medium tracking-tight">{{item.label}}</span>
                  <span
                    class="px-1.5 py-0.5 rounded-md bg-brand-gold/10 border border-brand-gold/20 text-[10px] font-mono text-brand-gold uppercase tracking-widest">{{item.type}}</span>
                </div>
              </div>
            </div>
            } @else {
            @if (item.type !== 'heading' && item.type !== 'button' && item.type !== 'card') {
            <label class="block text-sm font-medium text-slate-400 mb-2">{{item.label}}</label>
            }
            }

            <div class="relative">
              @switch (item.type) {
              @case ('heading') { <h2 class="text-lg font-bold text-white" [class.text-2xl]="viewMode() === 'preview'"
                [class.border-b]="viewMode() === 'preview'" [class.border-white/10]="viewMode() === 'preview'"
                [class.pb-2]="viewMode() === 'preview'">{{item.label}}</h2> }
              @case ('input') {
              <input [(ngModel)]="item.props.value" [placeholder]="item.props.placeholder"
                class="bg-white/5 border border-white/10 p-2 rounded text-xs text-white w-full outline-none focus:border-brand-gold"
                [class.p-3]="viewMode() === 'preview'" [class.text-sm]="viewMode() === 'preview'">
              }
              @case ('textarea') {
              <textarea [(ngModel)]="item.props.value" [placeholder]="item.props.placeholder"
                [rows]="viewMode() === 'preview' ? 4 : 2"
                class="bg-white/5 border border-white/10 p-2 rounded text-xs text-white w-full outline-none focus:border-brand-gold"
                [class.p-3]="viewMode() === 'preview'" [class.text-sm]="viewMode() === 'preview'"></textarea>
              }
              @case ('button') { <button class="bg-brand-gold text-black px-4 py-1.5 rounded text-xs font-bold w-full"
                [class.py-3]="viewMode() === 'preview'"
                [class.text-sm]="viewMode() === 'preview'">{{item.label}}</button> }
              @case ('card') {
              <div class="p-4 bg-white/5 border border-white/10 rounded-lg" [class.p-6]="viewMode() === 'preview'">
                <h3 class="text-sm font-bold" [class.text-lg]="viewMode() === 'preview'">{{item.props.title ||
                  item.label}}</h3>
                <div class="mt-2 border border-dashed border-white/5 rounded" [class.h-8]="viewMode() === 'editor'"
                  [class.h-20]="viewMode() === 'preview'"></div>
              </div>
              }
              @case ('dropdown') {
              <select [(ngModel)]="item.props.value"
                class="bg-white/5 border border-white/10 p-2 rounded text-xs text-white w-full outline-none focus:border-brand-gold"
                [class.p-3]="viewMode() === 'preview'" [class.text-sm]="viewMode() === 'preview'">
                <option value="">Select Option</option>
                <option value="1">Option 1</option>
              </select>
              }
              @case ('checkbox') {
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" [(ngModel)]="item.props.value" class="accent-brand-gold"
                  [class.w-5]="viewMode() === 'preview'" [class.h-5]="viewMode() === 'preview'">
                <span class="text-xs text-slate-400" [class.text-sm]="viewMode() === 'preview'"
                  [class.text-slate-300]="viewMode() === 'preview'">{{item.label}}</span>
              </label>
              }
              @case ('radio') {
              <div class="flex flex-col gap-2">
                <label class="flex items-center gap-2 cursor-pointer">
                  <input type="radio" [name]="item.id + (viewMode() === 'preview' ? '_prev' : '')"
                    [(ngModel)]="item.props.value" value="1" class="accent-brand-gold">
                  <span class="text-xs text-slate-400" [class.text-sm]="viewMode() === 'preview'"
                    [class.text-slate-300]="viewMode() === 'preview'">Option 1</span>
                </label>
              </div>
              }
              @case ('datepicker') {
              <input type="date" [(ngModel)]="item.props.value"
                class="bg-white/5 border border-white/10 p-2 rounded text-xs text-white w-full outline-none focus:border-brand-gold"
                [class.p-3]="viewMode() === 'preview'" [class.text-sm]="viewMode() === 'preview'">
              }
              @default {
              <div class="italic text-slate-600 text-[10px]">Preview UI Placeholder</div>
              }
              }
            </div>

            <div *cdkDragPlaceholder
              class="bg-brand-gold/10 border-2 border-dashed border-brand-gold rounded-2xl h-full w-full"></div>
          </div>
          }
        </div>
      </div>
      }
    </div> -->
  </div>
</section>