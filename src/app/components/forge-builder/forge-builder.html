<div class="h-screen w-full bg-[#020617] text-slate-300 flex flex-col overflow-hidden font-['Tomorrow']"
    [ngStyle]="{ 'padding-top': headerHeight() + 'px' }">
    <header class="h-16 border-b border-white/5 bg-black/40 flex items-center justify-between px-8 shrink-0">
        <div class="flex items-center gap-1 bg-white/[0.05] p-1 rounded-xl border border-white/10">
            <button (click)="viewMode.set('editor')" [class.bg-brand-gold]="viewMode() === 'editor'"
                [class.text-black]="viewMode() === 'editor'"
                class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-2">
                <mat-icon class="text-[18px]">architecture</mat-icon>
                EDITOR
            </button>
            <button (click)="viewMode.set('preview')" [class.bg-brand-gold]="viewMode() === 'preview'"
                [class.text-black]="viewMode() === 'preview'"
                class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-2">
                <mat-icon class="text-[18px]">visibility</mat-icon>
                PREVIEW
            </button>
        </div>

        <div
            class="flex items-center gap-4 px-4 py-2 rounded-xl border border-white/10 bg-white/[0.05] backdrop-blur-xl">
            @for (flavor of flavors; track flavor.id) {
            <button (click)="selectedFlavor.set(flavor.name)"
                class="flex items-center gap-2 text-sm font-medium transition-all px-3 py-1 rounded-lg" [ngClass]="{
                        'bg-white/10 backdrop-blur-md': selectedFlavor() === flavor.name
                    }">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path [attr.fill]="selectedFlavor() === flavor.name ? flavor.color : 'rgba(255,255,255,0.5)'"
                        [attr.d]="flavor.iconPath" />
                </svg>
                <span [style.color]="selectedFlavor() === flavor.name ? flavor.color : 'rgb(148 163 184)'">{{
                    flavor.label }}</span>
            </button>
            }
        </div>

        <button (click)="exportProject()"
            class="bg-brand-gold hover:bg-brand-gold/80 text-black px-6 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(251,191,36,0.2)]">
            <mat-icon class="text-[18px]">download</mat-icon>
            EXPORT_LAYOUT
        </button>
    </header>

    <main class="flex flex-1 overflow-hidden" cdkDropListGroup>
        @if (viewMode() === 'editor') {
        <aside class="w-72 border-r border-white/5 bg-white/[0.01] p-6 overflow-y-auto">
            <h3 class="text-[15px] tracking-[0.3em] mb-8 text-brand-gold border-b border-brand-gold/10 pb-2">
                Fields/Elements
            </h3>
            <div cdkDropList [cdkDropListData]="toolbox" cdkDropListSortingDisabled="true" class="space-y-4">
                @for (item of toolbox; track item.type) {
                <div cdkDrag [cdkDragData]="item"
                    class="p-4 bg-white/[0.03] border border-white/10 rounded-xl cursor-grab hover:border-brand-gold/40 transition-all flex items-center gap-4 group">

                    <div *cdkDragPreview
                        class="flex items-center gap-3 p-2 bg-slate-900 border border-brand-gold rounded-xl text-white">
                        <mat-icon class="text-brand-gold">drag_indicator</mat-icon>
                        <span>{{item.label}}</span>
                    </div>

                    <mat-icon class="text-slate-400 group-hover:text-brand-gold">extension</mat-icon>
                    <span class="text-sm">{{item.label}}</span>
                </div>
                }
            </div>
        </aside>
        }

        <section class="flex-1 bg-[radial-gradient(#ffffff05_1px,transparent_1px)] bg-[size:30px_30px] flex flex-col">
            <div class="flex-1 p-5 overflow-y-auto">
                @if (viewMode() === 'editor') {
                <div cdkDropList (cdkDropListDropped)="onDrop($event)" #canvasList="cdkDropList"
                    [cdkDropListData]="canvasItems()" [cdkDropListOrientation]="'mixed'"
                    class="min-h-full w-full mx-auto border-2 border-dashed border-slate-800 rounded-[20px] p-5 transition-all"
                    [ngClass]="{'border-brand-gold/20': canvasItems().length === 0}">

                    <div class="flex gap-4 flex-wrap">
                        @for (item of canvasItems(); track item.id) {
                        <div (click)="selectedId.set(item.id)" cdkDrag
                            class="group relative mb-6 p-8 bg-white/[0.02] border border-white/10 rounded-3xl transition-all cursor-pointer ring-brand-gold flex-1"
                            [class.ring-2]="selectedId() === item.id">
                            <button (click)="removeItem(item.id, $event)"
                                class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 text-slate-500 hover:text-red-500 transition-opacity">
                                <mat-icon>close</mat-icon>
                            </button>
                            <div
                                class="absolute -top-3 left-6 px-3 py-1 bg-[#020617] border border-white/10 rounded-full text-[9px] font-mono text-brand-gold">
                                {{item.type}}</div>
                            <h4 class="text-lg font-bold text-white">{{item.label}}</h4>
                            <p class="text-xs text-slate-500">{{item.props.placeholder || 'Active Component node.'}}</p>
                        </div>
                        }
                    </div>
                </div>
                } @else {
                <div
                    class="max-w-6xl mx-auto p-10 bg-white/[0.02] rounded-[20px] border border-white/10 animate-in fade-in zoom-in duration-300">
                    <h2 class="text-[15px] tracking-[0.3em] mb-8 text-brand-gold border-b border-brand-gold/10 pb-2">
                        Molding Result</h2>
                    <div class="space-y-6">
                        @for (item of canvasItems(); track item.id) {
                        @if (item.type === 'heading') {
                        <h2 class="text-2xl font-bold text-white border-b border-white/10 pb-2">{{item.label}}</h2>
                        }

                        @if (item.type === 'textarea') {
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-mono text-slate-400">{{item.label}}</label>
                            <textarea [placeholder]="item.props.placeholder" [rows]="item.props.rows"
                                class="bg-white/5 border border-white/10 p-3 rounded-lg text-white w-full outline-none focus:border-brand-gold"></textarea>
                        </div>
                        }

                        @if (item.type === 'dropdown') {
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-mono text-slate-400">{{item.label}}</label>
                            <select class="bg-white/5 border border-white/10 p-3 rounded-lg text-white outline-none">
                                <option>Option 1</option>
                                <option>Option 2</option>
                            </select>
                        </div>
                        }

                        @if (item.type === 'checkbox') {
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <div
                                class="w-5 h-5 border-2 border-white/20 rounded group-hover:border-brand-gold flex items-center justify-center">
                                <div class="w-2.5 h-2.5 bg-brand-gold rounded-sm opacity-0 group-hover:opacity-50">
                                </div>
                            </div>
                            <span class="text-sm text-slate-300">{{item.label}}</span>
                        </label>
                        }

                        @if (item.type === 'datepicker') {
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-mono text-slate-400">{{item.label}}</label>
                            <div class="relative">
                                <input type="date"
                                    class="bg-white/5 border border-white/10 p-3 rounded-lg text-white w-full outline-none">
                            </div>
                        </div>
                        }

                        @if (item.type === 'buttongroup') {
                        <div class="flex gap-1 bg-white/5 p-1 rounded-xl w-fit border border-white/10">
                            <button
                                class="px-6 py-2 bg-brand-gold text-black rounded-lg font-bold text-xs">SAVE</button>
                            <button
                                class="px-6 py-2 hover:bg-white/10 text-white rounded-lg font-bold text-xs">CANCEL</button>
                        </div>
                        }

                        @if (item.type === 'input') {
                        <div class="flex flex-col gap-2">
                            <label class="text-sm">{{item.label}}</label>
                            <input [placeholder]="item.props.placeholder"
                                class="bg-white/5 border border-white/10 p-3 rounded-lg text-white outline-none focus:border-brand-gold transition-all">
                        </div>
                        }

                        @if (item.type === 'button') {
                        <button class="bg-brand-gold text-black px-6 py-2 rounded-lg font-bold">
                            {{item.label}}
                        </button>
                        }
                        }
                    </div>
                </div>
                }
            </div>

            @if (viewMode() === 'editor') {
            <div class="h-64 border-t border-white/10 bg-black/60 p-6 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-[13px] text-slate-400 tracking-widest">Output:
                        {{selectedFlavor() | titlecase }}</span>
                </div>
                <pre
                    class="flex-1 overflow-auto bg-black/40 p-5 rounded-xl border border-white/5 text-brand-gold/80 font-mono text-xs">{{ generatedCode() }}</pre>
            </div>
            }
        </section>

        @if (viewMode() === 'editor') {
        <aside class="w-80 border-l border-white/5 bg-white/[0.01] p-6">
            <h3 class="text-[15px] tracking-[0.3em] mb-8 text-brand-gold border-b border-brand-gold/10 pb-2">
                Fields Customizer</h3>
            @if (activeComponent(); as comp) {
            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Label</label>
                    <input [ngModel]="comp.label" (ngModelChange)="updateLabel($event)"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-sm text-white focus:border-brand-gold outline-none">
                </div>
                @if (comp.type === 'input') {
                <div class="space-y-2">
                    <label class="text-[10px] text-slate-500 uppercase font-bold">Placeholder</label>
                    <input [ngModel]="comp.props.placeholder" (ngModelChange)="updateProp('placeholder', $event)"
                        class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-sm text-white focus:border-brand-gold outline-none">
                </div>
                }
            </div>
            } @else {
            <p class="text-[14px] text-slate-600 text-center mt-20 italic">Select a field to
                customize
            </p>
            }
        </aside>
        }
    </main>
</div>