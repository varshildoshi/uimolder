<div class="h-screen w-full bg-[#020617] text-slate-300 flex flex-col overflow-hidden font-['Tomorrow']"
    [ngStyle]="{ 'padding-top': headerHeight() + 'px' }">

    <header class="h-16 border-b border-white/5 bg-black/40 flex items-center justify-between px-8 shrink-0">
        <div class="flex items-center gap-1 bg-white/[0.05] p-1 rounded-xl border border-white/10">
            <button (click)="viewMode.set('editor')" [class.bg-brand-gold]="viewMode() === 'editor'"
                [class.text-black]="viewMode() === 'editor'"
                class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-2">
                <mat-icon class="text-[18px]">architecture</mat-icon>
                EDITOR
            </button>
            <button (click)="viewMode.set('preview')" [class.bg-brand-gold]="viewMode() === 'preview'"
                [class.text-black]="viewMode() === 'preview'"
                class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-2">
                <mat-icon class="text-[18px]">visibility</mat-icon>
                PREVIEW
            </button>
        </div>

        <div
            class="flex items-center gap-4 px-4 py-2 rounded-xl border border-white/10 bg-white/[0.05] backdrop-blur-xl">
            @for (flavor of flavors; track flavor.id) {
            <button (click)="selectedFlavor.set(flavor.name)"
                class="flex items-center gap-2 text-sm font-medium transition-all px-3 py-1 rounded-lg" [ngClass]="{
                        'bg-white/10 backdrop-blur-md': selectedFlavor() === flavor.name
                    }">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path [attr.fill]="selectedFlavor() === flavor.name ? flavor.color : 'rgba(255,255,255,0.5)'"
                        [attr.d]="flavor.iconPath" />
                </svg>
                <span [style.color]="selectedFlavor() === flavor.name ? flavor.color : 'rgb(148 163 184)'">{{
                    flavor.label }}</span>
            </button>
            }
        </div>

        <button (click)="exportLayout()"
            class="bg-brand-gold hover:bg-brand-gold/80 text-black px-6 py-2 rounded-xl text-xs font-bold transition-all flex items-center gap-2 shadow-[0_0_15px_rgba(251,191,36,0.2)]">
            <mat-icon class="text-[18px]">download</mat-icon>
            EXPORT_LAYOUT
        </button>
    </header>

    <main class="flex flex-1 overflow-hidden" cdkDropListGroup>
        @if (viewMode() === 'editor') {
        <aside class="w-72 border-r border-white/5 bg-white/[0.01] p-6 overflow-y-auto">
            <h3 class="text-[15px] tracking-[0.3em] mb-8 text-brand-gold border-b border-brand-gold/10 pb-2">
                Fields/Elements</h3>
            <div cdkDropList [cdkDropListData]="toolbox" cdkDropListSortingDisabled="true"
                [cdkDropListConnectedTo]="rowIds()" class="space-y-4">
                @for (item of toolbox; track item.type) {
                <div cdkDrag [cdkDragData]="item"
                    class="p-4 bg-white/[0.03] border border-white/10 rounded-xl cursor-grab hover:border-brand-gold/40 transition-all flex items-center gap-4 group">

                    <div *cdkDragPreview
                        class="flex items-center gap-3 p-2 bg-slate-900 border border-brand-gold rounded-xl text-white">
                        <mat-icon class="text-brand-gold">drag_indicator</mat-icon>
                        <span>{{item.label}}</span>
                    </div>

                    <mat-icon class="text-slate-400 group-hover:text-brand-gold">extension</mat-icon>
                    <span class="text-sm">{{item.label}}</span>
                </div>
                }
            </div>
        </aside>
        }

        <section
            class="flex-1 bg-[radial-gradient(#ffffff05_1px,transparent_1px)] bg-[size:30px_30px] overflow-hidden flex flex-col p-10">

            <div class="max-w-4xl mx-auto w-full flex justify-between items-center mb-6">
                <button (click)="addNewRow()"
                    class="flex items-center gap-2 px-4 py-2 border border-brand-gold/20 bg-brand-gold/5 text-brand-gold rounded-xl text-[10px] font-bold uppercase hover:bg-brand-gold hover:text-black transition-all">
                    <mat-icon class="text-sm">add</mat-icon>
                    Add Row
                </button>
            </div>

            <div class="flex-1 overflow-y-auto space-y-12 pb-20">
                <div class="max-w-4xl mx-auto space-y-10">

                    @for (row of formRows(); track row.id; let i = $index) {
                    <div class="relative group/row">

                        <div class="absolute -top-6 left-2 flex items-center gap-3">
                            <span class="text-[10px] font-mono text-brand-gold/50 uppercase tracking-widest">Row</span>
                        </div>

                        <div cdkDropList [id]="row.id" [cdkDropListData]="row.fields"
                            [cdkDropListConnectedTo]="rowIds()" (cdkDropListDropped)="onDrop($event, row.id)"
                            class="min-h-[120px] border-2 border-dashed border-slate-800 rounded-3xl p-8 flex flex-wrap gap-4 transition-all"
                            [ngClass]="{'border-brand-gold/20': row.fields.length === 0}">

                            @if (row.fields.length === 0) {
                            <div class="w-full flex items-center justify-center pointer-events-none">
                                <p class="text-[9px] font-mono text-slate-700 uppercase tracking-widest">Drop elements
                                    here</p>
                            </div>
                            }

                            @for (field of row.fields; track field.id) {
                            <div (click)="selectedId.set(field.id)" cdkDrag [style.width.%]="field.width - 2"
                                class="group/field relative p-6 bg-white/[0.02] border border-white/10 rounded-2xl transition-all hover:border-white/20 cursor-pointer"
                                [class.ring-2.ring-brand-gold]="selectedId() === field.id">

                                <button (click)="removeField(row.id, field.id, $event)"
                                    class="absolute -top-2 -right-2 w-7 h-7 bg-red-500/10 border border-red-500/20 text-red-500 rounded-full flex items-center justify-center opacity-0 group-hover/field:opacity-100 hover:bg-red-500 hover:text-white transition-all z-10">
                                    <mat-icon class="text-sm">close</mat-icon>
                                </button>

                                <div class="flex items-center gap-3 mb-2">
                                    <mat-icon class="text-slate-600 text-[18px]">drag_indicator</mat-icon>
                                    <span class="text-[10px] font-mono text-brand-gold uppercase">{{field.type}}</span>
                                </div>
                                <div class="text-sm font-bold text-white">{{field.label}}</div>

                                <div *cdkDragPlaceholder
                                    class="bg-brand-gold/10 border-2 border-dashed border-brand-gold rounded-2xl h-full w-full">
                                </div>
                            </div>
                            }
                        </div>
                    </div>
                    }

                </div>
            </div>
        </section>

        @if (viewMode() === 'editor') {
        <aside class="w-80 border-l border-white/5 bg-white/[0.01] p-6">
            <h3 class="text-[15px] tracking-[0.3em] mb-8 text-brand-gold border-b border-brand-gold/10 pb-2">
                Fields Customizer</h3>
            @if (activeField(); as field) {
            <div class="space-y-6 animate-in fade-in duration-300">
                <div class="space-y-2">
                    <label class="text-[9px] text-slate-500 uppercase font-bold">Field Label</label>
                    <input [(ngModel)]="field.label"
                        class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-sm outline-none focus:border-brand-gold">
                </div>
                <div class="space-y-2">
                    <label class="text-[9px] text-slate-500 uppercase font-bold">Width (Density)</label>
                    <select [(ngModel)]="field.width"
                        class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-sm outline-none">
                        <option [value]="100">Full Width (100%)</option>
                        <option [value]="50">Half Width (50%)</option>
                    </select>
                </div>
            </div>
            } @else {
            <div class="text-[14px] text-slate-600 text-center mt-20 italic">Select a field to
                customize
            </div>
            }
        </aside>
        }
    </main>
</div>